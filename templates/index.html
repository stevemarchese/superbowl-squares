<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Bowl Squares</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header class="app-header">
            <div class="header-left">
                <div class="brand">
                    <img src="/static/logo.png" alt="Peglegs Logo" class="logo" id="teamLogo">
                    <div class="brand-text">
                        <h1>Super Bowl LX Squares</h1>
                        <div class="team-title">Stuyvesant Peglegs</div>
                        <div class="year-subtitle">2026 Fundraiser</div>
                    </div>
                </div>
            </div>
            <div class="header-right">
                <button onclick="showRulesModal()" class="rules-btn">Rules</button>
                <button onclick="showFaqModal()" class="rules-btn">FAQ</button>
                <button onclick="adminLogout()" class="logout-btn admin-only" id="logoutBtn" style="display:none;">Logout</button>
            </div>
        </header>

        <div class="quick-steps hide-for-admin">
            <div class="step-item">
                <span class="step-number">1</span>
                <span class="step-text">Click & Claim A Square</span>
            </div>
            <div class="step-item">
                <span class="step-number">2</span>
                <span class="step-text">Enter Your Info</span>
            </div>
            <div class="step-item">
                <span class="step-number">3</span>
                <span class="step-text">Venmo <strong>susan-mui-1</strong></span>
            </div>
            <div class="step-item">
                <span class="step-number">4</span>
                <span class="step-text">Come Back on Feb 8th!</span>
            </div>
        </div>


        <div class="grid-tabs-container">
            <div class="grid-tabs" id="gridTabs"></div>
        </div>

        <div class="grid-wrapper">
            <div class="grid-corner">
                <img src="/static/superbowl-logo.png" alt="Super Bowl LX" class="corner-logo">
            </div>
            <div class="team1-label" id="team1Label">Team 1</div>
            <div class="col-numbers" id="colNumbers"></div>
            <div class="team2-label" id="team2Label">Team 2</div>
            <div class="row-numbers" id="rowNumbers"></div>
            <div class="grid" id="grid"></div>
        </div>

        <div class="winners-section" id="winnersSection" style="display: none;">
            <h2>Winners</h2>
            <div id="winnersList"></div>
        </div>

        <div class="fundraiser-stats hide-for-admin">
            <div class="stat-box">
                <span class="stat-label">Squares Sold:</span>
                <span class="stat-value" id="squaresSoldPublic">0 / 100</span>
            </div>
            <div class="stat-box">
                <span class="stat-label">Total Collected:</span>
                <span class="stat-value" id="totalCollectedPublic">$0.00</span>
            </div>
        </div>

        <div class="prize-breakdown hide-for-admin">
            <div class="prize-row">
                <div class="prize-item">
                    <span class="prize-label">Q1 Prize</span>
                    <span class="prize-amount" id="prizeQ1">$0</span>
                </div>
                <div class="prize-item">
                    <span class="prize-label">Halftime Prize</span>
                    <span class="prize-amount" id="prizeQ2">$0</span>
                </div>
                <div class="prize-item">
                    <span class="prize-label">Q3 Prize</span>
                    <span class="prize-amount" id="prizeQ3">$0</span>
                </div>
                <div class="prize-item">
                    <span class="prize-label">Final Prize</span>
                    <span class="prize-amount" id="prizeQ4">$0</span>
                </div>
            </div>
            <div class="charity-highlight">
                <span class="charity-label">Total Funds Raised for Stuyvesant Baseball</span>
                <span class="charity-amount" id="charityAmount">$0</span>
            </div>
        </div>

        <!-- Admin Accordion Sections -->
        <div class="admin-accordion admin-only">
            <!-- Team & Score Administration -->
            <div class="accordion-section" id="accordionTeams">
                <button class="accordion-header" onclick="toggleAccordion('accordionTeams')">
                    <span>Team & Score Administration</span>
                    <span class="accordion-icon">+</span>
                </button>
                <div class="accordion-content">
                    <div class="team-admin-grid">
                        <div class="team-admin-item">
                            <h4>Team 1 (columns)</h4>
                            <div class="control-group">
                                <label>Team Name:</label>
                                <div class="input-row">
                                    <input type="text" id="team1" placeholder="Team 1">
                                    <button onclick="saveTeamName(1)">Save</button>
                                </div>
                            </div>
                            <div class="control-group">
                                <label>Team Color:</label>
                                <div class="input-row">
                                    <input type="color" id="team1Color" value="#0060aa" onchange="saveTeamColor(1)">
                                    <span class="color-label" id="team1ColorLabel">#0060aa</span>
                                </div>
                            </div>
                            <div class="control-group">
                                <label>Team Logo:</label>
                                <div class="logo-upload">
                                    <img id="team1LogoPreview" class="logo-preview" src="" alt="Team 1 Logo">
                                    <input type="file" id="team1Logo" accept="image/*" onchange="previewLogo(1)">
                                    <button onclick="uploadLogo(1)">Upload</button>
                                </div>
                            </div>
                        </div>
                        <div class="team-admin-item">
                            <h4>Team 2 (rows)</h4>
                            <div class="control-group">
                                <label>Team Name:</label>
                                <div class="input-row">
                                    <input type="text" id="team2" placeholder="Team 2">
                                    <button onclick="saveTeamName(2)">Save</button>
                                </div>
                            </div>
                            <div class="control-group">
                                <label>Team Color:</label>
                                <div class="input-row">
                                    <input type="color" id="team2Color" value="#cc0000" onchange="saveTeamColor(2)">
                                    <span class="color-label" id="team2ColorLabel">#cc0000</span>
                                </div>
                            </div>
                            <div class="control-group">
                                <label>Team Logo:</label>
                                <div class="logo-upload">
                                    <img id="team2LogoPreview" class="logo-preview" src="" alt="Team 2 Logo">
                                    <input type="file" id="team2Logo" accept="image/*" onchange="previewLogo(2)">
                                    <button onclick="uploadLogo(2)">Upload</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <h4 class="section-subtitle">Scores</h4>
                    <div class="quarters">
                        <div class="quarter">
                            <h3>Q1</h3>
                            <input type="number" id="q1_team1" placeholder="Team 1" onchange="saveScores()">
                            <input type="number" id="q1_team2" placeholder="Team 2" onchange="saveScores()">
                        </div>
                        <div class="quarter">
                            <h3>Q2</h3>
                            <input type="number" id="q2_team1" placeholder="Team 1" onchange="saveScores()">
                            <input type="number" id="q2_team2" placeholder="Team 2" onchange="saveScores()">
                        </div>
                        <div class="quarter">
                            <h3>Q3</h3>
                            <input type="number" id="q3_team1" placeholder="Team 1" onchange="saveScores()">
                            <input type="number" id="q3_team2" placeholder="Team 2" onchange="saveScores()">
                        </div>
                        <div class="quarter">
                            <h3>Q4 / Final</h3>
                            <input type="number" id="q4_team1" placeholder="Team 1" onchange="saveScores()">
                            <input type="number" id="q4_team2" placeholder="Team 2" onchange="saveScores()">
                        </div>
                    </div>
                    <div class="control-group winners-toggle">
                        <label class="toggle-label">
                            <input type="checkbox" id="showWinnersToggle" onchange="toggleShowWinners()">
                            <span>Show Winners Section</span>
                        </label>
                        <p class="toggle-hint">Enable on game day to display winners to visitors</p>
                    </div>
                </div>
            </div>

            <!-- Grid Administration -->
            <div class="accordion-section" id="accordionGrid">
                <button class="accordion-header" onclick="toggleAccordion('accordionGrid')">
                    <span>Grid Administration</span>
                    <span class="accordion-icon">+</span>
                </button>
                <div class="accordion-content">
                    <div class="admin-grid-controls">
                        <div class="control-group">
                            <label>Price per Square:</label>
                            <div class="input-row">
                                <span>$</span>
                                <input type="number" id="pricePerSquare" value="10" min="0" step="0.01" onchange="savePrice()">
                            </div>
                        </div>
                        <div class="control-group">
                            <label>Squares Limit per Person:</label>
                            <div class="input-row">
                                <input type="number" id="squaresLimitInput" value="5" min="1" max="100" onchange="saveSquaresLimit()">
                            </div>
                        </div>
                    </div>
                    <div class="admin-stats-row">
                        <div class="stat-box">
                            <span class="stat-label">Squares Sold:</span>
                            <span class="stat-value" id="squaresSold">0 / 100</span>
                        </div>
                        <div class="stat-box">
                            <span class="stat-label">Total Collected:</span>
                            <span class="stat-value" id="totalCollected">$0.00</span>
                        </div>
                    </div>
                    <div class="controls">
                        <button onclick="randomizeNumbers()" id="randomizeBtn">Randomize Numbers</button>
                        <button onclick="lockNumbers()" id="lockBtn">Lock Numbers</button>
                    </div>
                </div>
            </div>

            <!-- Prize Percentages -->
            <div class="accordion-section" id="accordionPrizes">
                <button class="accordion-header" onclick="toggleAccordion('accordionPrizes')">
                    <span>Prize Percentages</span>
                    <span class="accordion-icon">+</span>
                </button>
                <div class="accordion-content">
                    <p class="config-note">Set the percentage of total collected for each quarter prize. Remainder goes to charity.</p>
                    <div class="prize-inputs">
                        <div class="prize-input-group">
                            <label>Q1:</label>
                            <input type="number" id="prizeQ1Pct" value="10" min="0" max="100" step="1" onchange="savePrizePercentages()">
                            <span>%</span>
                        </div>
                        <div class="prize-input-group">
                            <label>Halftime:</label>
                            <input type="number" id="prizeQ2Pct" value="10" min="0" max="100" step="1" onchange="savePrizePercentages()">
                            <span>%</span>
                        </div>
                        <div class="prize-input-group">
                            <label>Q3:</label>
                            <input type="number" id="prizeQ3Pct" value="10" min="0" max="100" step="1" onchange="savePrizePercentages()">
                            <span>%</span>
                        </div>
                        <div class="prize-input-group">
                            <label>Final:</label>
                            <input type="number" id="prizeQ4Pct" value="20" min="0" max="100" step="1" onchange="savePrizePercentages()">
                            <span>%</span>
                        </div>
                        <div class="prize-total">
                            <span>Charity: <strong id="charityPct">50</strong>%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Participant Management -->
            <div class="accordion-section" id="accordionParticipants">
                <button class="accordion-header" onclick="toggleAccordion('accordionParticipants')">
                    <span>Participant Management</span>
                    <span class="accordion-icon">+</span>
                </button>
                <div class="accordion-content">
                    <div class="participants-header">
                        <div class="participants-stats">
                            <span id="participantsCount">0 participants</span>
                            <span class="stat-divider">|</span>
                            <span id="unpaidCount">0 unpaid</span>
                            <span class="stat-divider">|</span>
                            <span id="totalOwed">$0.00 outstanding</span>
                        </div>
                        <button onclick="exportUnpaid()" class="export-btn">Export Unpaid (CSV)</button>
                    </div>
                    <div class="participants-filter">
                        <button class="filter-btn active" onclick="filterParticipants('all')">All</button>
                        <button class="filter-btn" onclick="filterParticipants('unpaid')">Unpaid</button>
                        <button class="filter-btn" onclick="filterParticipants('paid')">Paid</button>
                    </div>
                    <div class="participants-list" id="participantsList">
                        <p class="loading-text">Loading participants...</p>
                    </div>
                </div>
            </div>

            <!-- Administration -->
            <div class="accordion-section" id="accordionAdmin">
                <button class="accordion-header" onclick="toggleAccordion('accordionAdmin')">
                    <span>Administration</span>
                    <span class="accordion-icon">+</span>
                </button>
                <div class="accordion-content">
                    <div class="admin-buttons">
                        <button onclick="showChangePasswordModal()">Account Settings</button>
                        <button onclick="resetGame()" class="danger-btn">Reset Game</button>
                    </div>
                </div>
            </div>
        </div>

        <footer class="site-footer">
            <div class="footer-links">
                <button onclick="showRulesModal()" class="footer-link">Rules</button>
                <span class="footer-divider">|</span>
                <button onclick="showFaqModal()" class="footer-link">FAQ</button>
                <span class="footer-divider">|</span>
                <a href="/admin" class="footer-link" id="adminLink">Admin</a>
            </div>
            <p>&copy; 2026 Steve Marchese. All rights reserved.</p>
        </footer>
    </div>

    <!-- Floating Claim Button -->
    <div class="claim-selected-container" id="claimSelectedContainer">
        <button class="claim-selected-btn" id="claimSelectedBtn" onclick="openClaimModalMulti()">Claim Squares</button>
        <div class="claim-info">
            <span id="claimLimitInfo">You may claim 5 boxes max (0/5)</span>
            <span id="claimTotalAmount">Total: $0.00</span>
        </div>
    </div>

    <!-- Claim Modal - Step 1: Enter Details -->
    <div class="modal" id="claimModal">
        <div class="modal-content">
            <p class="step-label">Step 1 of 2</p>
            <h2>Claim <span id="modalSquaresCount">1</span> Square<span id="modalPlural">s</span></h2>
            <p class="modal-subtitle"><span id="modalSquaresList"></span></p>
            <div class="form-group">
                <label for="claimName">Your Name (max 25 characters)</label>
                <input type="text" id="claimName" placeholder="Enter your name" maxlength="25">
            </div>
            <div class="form-group">
                <label for="claimEmail">Your Email</label>
                <input type="email" id="claimEmail" placeholder="Enter your email">
            </div>
            <div class="modal-buttons">
                <button onclick="showConfirmation()">Continue</button>
                <button onclick="closeModal()" class="cancel-btn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal - Step 2: Payment Instructions -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <p class="step-label">Step 2 of 2</p>
            <h2>Payment Instructions</h2>
            <div class="confirm-details">
                <p><strong>Squares (<span id="confirmSquaresCount">1</span>):</strong> <span id="confirmSquaresList"></span></p>
                <p><strong>Name:</strong> <span id="confirmName"></span></p>
                <p><strong>Email:</strong> <span id="confirmEmail"></span></p>
                <p class="total-owed"><strong>Total Owed:</strong> <span id="confirmTotalOwed">$0.00</span></p>
            </div>
            <div class="payment-instructions">
                <p>Please Venmo your payment to:</p>
                <p class="venmo-handle">@susan-mui-1</p>
                <p class="payment-deadline">Payment due by <strong>Friday, February 6</strong></p>
                <p class="payment-note">Please include the name you used in your box in your Venmo transaction.</p>
            </div>
            <div class="warning-box">
                Your box will be abandoned and prize money will go to FSB if you do not pay for your box by that date.
            </div>
            <div class="modal-buttons">
                <button onclick="submitClaim()">Confirm Selection</button>
                <button onclick="backToDetails()" class="cancel-btn">Go Back</button>
            </div>
        </div>
    </div>

    <!-- Success Modal - After claiming -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <div class="success-icon">&#10003;</div>
            <h2>Success!</h2>
            <p class="success-message">You've claimed <span id="successSquaresCount">1</span> square<span id="successPlural">s</span>!</p>
            <div class="confirm-details">
                <p><strong>Total Owed:</strong> <span id="successTotalOwed" class="total-amount">$0.00</span></p>
            </div>
            <div class="payment-instructions">
                <p>Please Venmo your payment to:</p>
                <p class="venmo-handle">@susan-mui-1</p>
                <p class="payment-deadline">Payment due by <strong>Friday, February 6</strong></p>
                <p class="payment-note">Please include the name you used in your box in your Venmo transaction.</p>
            </div>
            <div class="warning-box">
                Your box will be abandoned and prize money will go to FSB if you do not pay for your box by that date.
            </div>
            <div class="modal-buttons">
                <button onclick="closeSuccessModal()">Done</button>
            </div>
        </div>
    </div>

    <!-- Admin Clear Square Modal -->
    <div class="modal" id="adminClearModal">
        <div class="modal-content">
            <h2>Clear Square</h2>
            <p>This square is claimed by <strong id="clearOwnerName"></strong></p>
            <p>Row <span id="clearRow"></span>, Column <span id="clearCol"></span></p>
            <div class="modal-buttons">
                <button onclick="adminClearSquare()" class="danger-btn">Clear Square</button>
                <button onclick="closeAdminModal()" class="cancel-btn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Change Credentials Modal -->
    <div class="modal" id="changePasswordModal">
        <div class="modal-content">
            <h2>Account Settings</h2>
            <div class="error-msg" id="passwordErrorMsg" style="display:none; background:#f44336; color:white; padding:10px; border-radius:5px; margin-bottom:15px;"></div>
            <div class="success-msg" id="passwordSuccessMsg" style="display:none; background:#4caf50; color:white; padding:10px; border-radius:5px; margin-bottom:15px;"></div>
            <form id="changePasswordForm">
                <div class="form-group">
                    <label for="currentPassword">Current Password (required)</label>
                    <input type="password" id="currentPassword" required>
                </div>
                <hr style="border-color:#444; margin:20px 0;">
                <div class="form-group">
                    <label for="newEmail">New Email (leave blank to keep current)</label>
                    <input type="email" id="newEmail" placeholder="Enter new email">
                </div>
                <div class="form-group">
                    <label for="newPassword">New Password (leave blank to keep current)</label>
                    <input type="password" id="newPassword" minlength="6" placeholder="Enter new password">
                </div>
                <div class="form-group">
                    <label for="confirmPassword">Confirm New Password</label>
                    <input type="password" id="confirmPassword" minlength="6" placeholder="Confirm new password">
                </div>
                <div class="modal-buttons">
                    <button type="submit">Save Changes</button>
                    <button type="button" onclick="closeChangePasswordModal()" class="cancel-btn">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Rules Modal -->
    <div class="modal" id="rulesModal">
        <div class="modal-content rules-modal">
            <button class="modal-close" onclick="closeRulesModal()">&times;</button>
            <h2>Welcome to Super Bowl LX Squares!</h2>
            <p class="modal-subtitle">Stuyvesant Peglegs 2026 Fundraiser</p>

            <div class="rules-list">
                <div class="rule-item">
                    <span class="rule-number">1</span>
                    <div class="rule-text">
                        <strong>Claim Your Squares</strong>
                        <p>Click any available square on the grid to claim it. You may select up to 5 squares per email address.</p>
                    </div>
                </div>
                <div class="rule-item">
                    <span class="rule-number">2</span>
                    <div class="rule-text">
                        <strong>Enter Your Info</strong>
                        <p>Provide your name and email to claim a square. Once confirmed, your selection cannot be changed.</p>
                    </div>
                </div>
                <div class="rule-item">
                    <span class="rule-number">3</span>
                    <div class="rule-text">
                        <strong>Pay for Your Squares</strong>
                        <p>Venmo your payment to <strong>@susan-mui-1</strong> by <strong>Friday, February 6</strong>. Include your name in the transaction. Unpaid squares will be released.</p>
                    </div>
                </div>
                <div class="rule-item">
                    <span class="rule-number">4</span>
                    <div class="rule-text">
                        <strong>Come Back At Game Time Feb 8th!</strong>
                        <p>After all squares are claimed, random numbers (0-9) will be assigned to each row and column. Winners are determined by the last digit of each team's score at the end of each quarter. Match both digits to win. You can win all 4 quarters, so good luck!</p>
                    </div>
                </div>
            </div>

            <div class="prizes-section">
                <h3>Prize Breakdown</h3>
                <div class="prize-grid">
                    <div class="prize-item">
                        <span class="prize-label">1st Quarter</span>
                        <span class="prize-value">10%</span>
                    </div>
                    <div class="prize-item">
                        <span class="prize-label">Halftime</span>
                        <span class="prize-value">10%</span>
                    </div>
                    <div class="prize-item">
                        <span class="prize-label">3rd Quarter</span>
                        <span class="prize-value">10%</span>
                    </div>
                    <div class="prize-item">
                        <span class="prize-label">Final Score</span>
                        <span class="prize-value">20%</span>
                    </div>
                </div>
                <div class="fundraiser-note">
                    <strong>50% of all proceeds</strong> go to the Friends of Stuyvesant Baseball to support the Varsity and JV Baseball teams.
                </div>
            </div>

            <div class="modal-buttons">
                <button onclick="closeRulesModal()">Got It!</button>
            </div>
        </div>
    </div>

    <!-- FAQ Modal -->
    <div class="modal" id="faqModal">
        <div class="modal-content rules-modal">
            <button class="modal-close" onclick="closeFaqModal()">&times;</button>
            <h2>Frequently Asked Questions</h2>
            <p class="modal-subtitle">Super Bowl Squares FAQ</p>

            <div class="faq-list">
                <div class="faq-item" onclick="toggleFaq(this)">
                    <div class="faq-question">How do Super Bowl Squares work? <span class="faq-icon">+</span></div>
                    <div class="faq-answer">Each square on the 10x10 grid represents a unique combination of the last digit of each team's score. After all squares are claimed, random numbers (0-9) are assigned to each row and column. At the end of each quarter, if the last digits of the scores match your square, you win!</div>
                </div>
                <div class="faq-item" onclick="toggleFaq(this)">
                    <div class="faq-question">How much does each square cost? <span class="faq-icon">+</span></div>
                    <div class="faq-answer">Each square costs $20. You can claim up to 5 squares per email address.</div>
                </div>
                <div class="faq-item" onclick="toggleFaq(this)">
                    <div class="faq-question">How do I pay for my squares? <span class="faq-icon">+</span></div>
                    <div class="faq-answer">After claiming your squares, please Venmo your payment to <strong>@susan-mui-1</strong>. Payment is due by <strong>Friday, February 6</strong>. Please make sure to put the name you used in your box in your Venmo transaction. Unpaid squares will be released.</div>
                </div>
                <div class="faq-item" onclick="toggleFaq(this)">
                    <div class="faq-question">When are the numbers assigned? <span class="faq-icon">+</span></div>
                    <div class="faq-answer">The row and column numbers are randomly assigned after all squares have been claimed and paid for. This ensures fair and random distribution.</div>
                </div>
                <div class="faq-item" onclick="toggleFaq(this)">
                    <div class="faq-question">How are winners determined? <span class="faq-icon">+</span></div>
                    <div class="faq-answer">At the end of each quarter, we look at the last digit of each team's score. The square where those two numbers intersect is the winner. For example, if the score is Chiefs 17, Eagles 14, the winning square is where column 7 meets row 4.</div>
                </div>
                <div class="faq-item" onclick="toggleFaq(this)">
                    <div class="faq-question">What are the prizes? <span class="faq-icon">+</span></div>
                    <div class="faq-answer">Prizes are 10% of the pot for Q1, Q2 (halftime), and Q3, and 20% for the final score. The remaining 50% goes to Friends of Stuyvesant Baseball.</div>
                </div>
                <div class="faq-item" onclick="toggleFaq(this)">
                    <div class="faq-question">Can I change my squares after claiming? <span class="faq-icon">+</span></div>
                    <div class="faq-answer">No, once you confirm your selection, it cannot be changed. Please review your choices carefully before confirming.</div>
                </div>
                <div class="faq-item" onclick="toggleFaq(this)">
                    <div class="faq-question">What is Friends of Stuyvesant Baseball? <span class="faq-icon">+</span></div>
                    <div class="faq-answer">The purpose of Friends of Stuyvesant Baseball, Inc. (FSB), is to support the junior varsity and varsity baseball teams for Stuyvesant High School, a public school in New York City. FSB supports these teams by raising and distributing funds and promoting interest in the teams. FSB is a nonprofit 501(c)(3) corporation, organized and operated for public and charitable purposes, not for the private gain of any person. The IRS ruling granting Friends of Stuyvesant Baseball 501(c)(3) status was issued in February of 2010.</div>
                </div>
            </div>

            <div class="modal-buttons">
                <button onclick="closeFaqModal()">Close</button>
            </div>
        </div>
    </div>

    <script src="/static/app.js"></script>
    <script>
        // Hide logo if it fails to load
        document.getElementById('teamLogo').onerror = function() {
            this.classList.add('hidden');
        };

        // Rules modal functions
        function showRulesModal() {
            document.getElementById('rulesModal').classList.add('active');
        }

        function closeRulesModal() {
            document.getElementById('rulesModal').classList.remove('active');
            localStorage.setItem('rulesShown', 'true');
        }

        // Show rules modal on first visit
        if (!localStorage.getItem('rulesShown')) {
            document.getElementById('rulesModal').classList.add('active');
        }

        // FAQ modal functions
        function showFaqModal() {
            document.getElementById('faqModal').classList.add('active');
        }

        function closeFaqModal() {
            document.getElementById('faqModal').classList.remove('active');
        }

        function toggleFaq(item) {
            const wasOpen = item.classList.contains('open');
            // Close all FAQ items
            document.querySelectorAll('.faq-item').forEach(faq => {
                faq.classList.remove('open');
            });
            // Open clicked item if it wasn't already open
            if (!wasOpen) {
                item.classList.add('open');
            }
        }

        // Change password modal functions
        function showChangePasswordModal() {
            document.getElementById('changePasswordModal').classList.add('active');
            document.getElementById('changePasswordForm').reset();
            document.getElementById('passwordErrorMsg').style.display = 'none';
            document.getElementById('passwordSuccessMsg').style.display = 'none';
        }

        function closeChangePasswordModal() {
            document.getElementById('changePasswordModal').classList.remove('active');
        }

        document.getElementById('changePasswordForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const errorMsg = document.getElementById('passwordErrorMsg');
            const successMsg = document.getElementById('passwordSuccessMsg');
            errorMsg.style.display = 'none';
            successMsg.style.display = 'none';

            const currentPassword = document.getElementById('currentPassword').value;
            const newEmail = document.getElementById('newEmail').value.trim();
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (!newEmail && !newPassword) {
                errorMsg.textContent = 'Please enter a new email or password';
                errorMsg.style.display = 'block';
                return;
            }

            if (newPassword && newPassword !== confirmPassword) {
                errorMsg.textContent = 'New passwords do not match';
                errorMsg.style.display = 'block';
                return;
            }

            try {
                const response = await fetch('/api/admin/change-credentials', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        current_password: currentPassword,
                        new_email: newEmail,
                        new_password: newPassword,
                        confirm_password: confirmPassword
                    })
                });

                const result = await response.json();

                if (result.error) {
                    errorMsg.textContent = result.error;
                    errorMsg.style.display = 'block';
                } else {
                    successMsg.textContent = 'Settings updated successfully!';
                    successMsg.style.display = 'block';
                    document.getElementById('changePasswordForm').reset();
                    setTimeout(() => closeChangePasswordModal(), 1500);
                }
            } catch (error) {
                errorMsg.textContent = 'An error occurred. Please try again.';
                errorMsg.style.display = 'block';
            }
        });
    </script>
</body>
</html>
